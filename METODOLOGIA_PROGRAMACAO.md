# üíª Metodologia de Programa√ß√£o - Tio ZooEstatisco

## üéØ Objetivo
Este documento descreve a metodologia de programa√ß√£o utilizada no desenvolvimento da aplica√ß√£o Tio ZooEstatisco, incluindo tecnologias, sintaxes, linguagens e padr√µes de desenvolvimento.

## üõ†Ô∏è Stack Tecnol√≥gico

### Linguagem Principal
- **Python 3.8+**: Linguagem de programa√ß√£o principal
- **Sintaxe**: PEP 8 (Python Enhancement Proposal 8)
- **Tipagem**: Type hints para melhor documenta√ß√£o e IDE support

### Framework Web
- **Streamlit**: Framework Python para aplica√ß√µes web interativas
- **Vers√£o**: 1.28.0+
- **Caracter√≠sticas**: 
  - Interface declarativa
  - Componentes interativos nativos
  - Cache autom√°tico para performance

### Bibliotecas de Dados
- **Pandas**: Manipula√ß√£o e an√°lise de dados estruturados
- **NumPy**: Computa√ß√£o num√©rica e arrays multidimensionais
- **SciPy**: Fun√ß√µes estat√≠sticas e cient√≠ficas

### Visualiza√ß√£o
- **Plotly**: Gr√°ficos interativos e dashboards
- **Matplotlib**: Gr√°ficos est√°ticos para exporta√ß√£o
- **Seaborn**: Visualiza√ß√µes estat√≠sticas (quando necess√°rio)

### Processamento de Arquivos
- **OpenPyXL**: Leitura e escrita de arquivos Excel
- **XlsxWriter**: Cria√ß√£o avan√ßada de arquivos Excel
- **ReportLab**: Gera√ß√£o de relat√≥rios PDF

### Intelig√™ncia Artificial
- **Ollama**: Integra√ß√£o com modelos locais de IA
- **Google Generative AI**: API do Gemini
- **OpenAI**: API do GPT (opcional)

## üìÅ Arquitetura do Projeto

### Estrutura de Diret√≥rios
```
tcc-gado-gordo/
‚îú‚îÄ‚îÄ app.py                          # Ponto de entrada principal
‚îú‚îÄ‚îÄ requirements.txt                # Depend√™ncias do projeto
‚îú‚îÄ‚îÄ core/                          # M√≥dulos principais
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py               # Inicializa√ß√£o do pacote
‚îÇ   ‚îú‚îÄ‚îÄ cleaning.py               # Limpeza e processamento de dados
‚îÇ   ‚îú‚îÄ‚îÄ stats.py                  # An√°lises estat√≠sticas descritivas
‚îÇ   ‚îú‚îÄ‚îÄ plots.py                  # Gera√ß√£o de gr√°ficos
‚îÇ   ‚îú‚îÄ‚îÄ variable_curation.py      # Curadoria de vari√°veis
‚îÇ   ‚îú‚îÄ‚îÄ ai_assistant.py           # Assistente de IA
‚îÇ   ‚îú‚îÄ‚îÄ formatters.py             # Formata√ß√£o brasileira
‚îÇ   ‚îú‚îÄ‚îÄ excel_export.py           # Exporta√ß√£o Excel
‚îÇ   ‚îú‚îÄ‚îÄ pdf_report.py             # Relat√≥rios PDF
‚îÇ   ‚îú‚îÄ‚îÄ notifications.py          # Sistema de notifica√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ theme_manager.py          # Gerenciamento de temas
‚îÇ   ‚îî‚îÄ‚îÄ flags.py                  # Feature flags
‚îú‚îÄ‚îÄ pages/                        # P√°ginas Streamlit
‚îÇ   ‚îú‚îÄ‚îÄ 1_Upload_e_Analise.py     # Upload e an√°lise
‚îÇ   ‚îú‚îÄ‚îÄ 2_Resultados_e_Export.py  # Resultados e exporta√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ 3_Assistente_IA.py        # Assistente IA
‚îÇ   ‚îî‚îÄ‚îÄ 4_Calculadoras.py         # Calculadoras
‚îú‚îÄ‚îÄ output/                       # Arquivos gerados
‚îÇ   ‚îú‚îÄ‚îÄ figuras/                  # Gr√°ficos salvos
‚îÇ   ‚îú‚îÄ‚îÄ tabelas/                  # Tabelas exportadas
‚îÇ   ‚îî‚îÄ‚îÄ upload_history.json       # Hist√≥rico de uploads
‚îî‚îÄ‚îÄ static/                       # Arquivos est√°ticos
```

### Padr√µes de Nomenclatura

#### Arquivos Python
- **Conven√ß√£o**: snake_case
- **Exemplos**: `variable_curation.py`, `excel_export.py`

#### Fun√ß√µes e Vari√°veis
- **Conven√ß√£o**: snake_case
- **Exemplos**: `descriptive_stats()`, `create_scatter_plot()`

#### Classes
- **Conven√ß√£o**: PascalCase
- **Exemplos**: `AIAssistant`, `ThemeManager`

#### Constantes
- **Conven√ß√£o**: UPPER_SNAKE_CASE
- **Exemplos**: `ENABLE_EXCEL_ADVANCED`, `MAX_FILE_SIZE`

## üîß Padr√µes de Desenvolvimento

### 1. Estrutura de Fun√ß√µes

#### Template B√°sico
```python
def function_name(param1: type, param2: type) -> return_type:
    """
    Descri√ß√£o clara da fun√ß√£o.
    
    Args:
        param1 (type): Descri√ß√£o do par√¢metro
        param2 (type): Descri√ß√£o do par√¢metro
    
    Returns:
        return_type: Descri√ß√£o do retorno
    
    Raises:
        ValueError: Quando par√¢metros s√£o inv√°lidos
    """
    # Implementa√ß√£o
    pass
```

#### Exemplo Pr√°tico
```python
def descriptive_stats(series: pd.Series) -> Dict[str, float]:
    """
    Calcula estat√≠sticas descritivas b√°sicas de uma s√©rie.
    
    Args:
        series (pd.Series): S√©rie de dados para an√°lise
    
    Returns:
        Dict[str, float]: Dicion√°rio com estat√≠sticas descritivas
    
    Raises:
        ValueError: Se a s√©rie estiver vazia
    """
    series_clean = series.dropna()
    
    if len(series_clean) == 0:
        raise ValueError("S√©rie n√£o pode estar vazia")
    
    return {
        'N': len(series_clean),
        'M√©dia': series_clean.mean(),
        'DP': series_clean.std(ddof=1),
        'Mediana': series_clean.median(),
        'M√≠nimo': series_clean.min(),
        'M√°ximo': series_clean.max()
    }
```

### 2. Tratamento de Erros

#### Padr√£o de Try-Catch
```python
def safe_function(data):
    """Fun√ß√£o com tratamento robusto de erros."""
    try:
        # Opera√ß√£o principal
        result = process_data(data)
        return result
    except FileNotFoundError:
        st.error("Arquivo n√£o encontrado")
        return None
    except pd.errors.EmptyDataError:
        st.warning("Arquivo est√° vazio")
        return None
    except Exception as e:
        st.error(f"Erro inesperado: {str(e)}")
        return None
```

### 3. Valida√ß√£o de Dados

#### Padr√£o de Valida√ß√£o
```python
def validate_dataframe(df: pd.DataFrame) -> bool:
    """Valida se DataFrame est√° em formato correto."""
    if df is None:
        st.error("DataFrame n√£o pode ser None")
        return False
    
    if df.empty:
        st.warning("DataFrame est√° vazio")
        return False
    
    required_columns = ['ANO', 'ESTADO', 'RA√áA']
    missing_columns = [col for col in required_columns if col not in df.columns]
    
    if missing_columns:
        st.error(f"Colunas obrigat√≥rias ausentes: {missing_columns}")
        return False
    
    return True
```

### 4. Cache e Performance

#### Cache do Streamlit
```python
@st.cache_data
def expensive_computation(data):
    """Fun√ß√£o com cache para melhorar performance."""
    # Computa√ß√£o pesada
    result = complex_calculation(data)
    return result

@st.cache_resource
def load_large_dataset():
    """Carrega dataset grande com cache de recurso."""
    return pd.read_csv('large_dataset.csv')
```

## üìä Padr√µes de An√°lise de Dados

### 1. Curadoria de Vari√°veis

#### Identifica√ß√£o de Tipos
```python
def analyze_variable_type(series: pd.Series) -> Dict[str, Any]:
    """Identifica tipo de vari√°vel e sugere an√°lises."""
    if series.dtype == 'object' or series.dtype.name == 'category':
        return {
            'type': 'categorical',
            'analysis': ['frequency', 'pie_chart', 'bar_chart'],
            'avoid': ['mean', 'std', 'confidence_interval']
        }
    elif pd.api.types.is_numeric_dtype(series):
        return {
            'type': 'quantitative',
            'analysis': ['descriptive_stats', 'histogram', 'boxplot'],
            'avoid': ['frequency']
        }
```

### 2. An√°lise Descritiva

#### Estat√≠sticas B√°sicas
```python
def comprehensive_descriptive_analysis(df: pd.DataFrame) -> Dict[str, Any]:
    """An√°lise descritiva abrangente baseada no tipo de vari√°vel."""
    results = {}
    
    for column in df.columns:
        var_info = analyze_variable_type(df[column])
        
        if var_info['type'] == 'quantitative':
            results[column] = {
                'type': 'quantitative',
                'descriptive_stats': descriptive_stats(df[column])
            }
        elif var_info['type'] == 'categorical':
            results[column] = {
                'type': 'categorical',
                'frequency': df[column].value_counts()
            }
    
    return results
```

### 3. Visualiza√ß√µes

#### Gera√ß√£o de Gr√°ficos
```python
def create_appropriate_plot(df: pd.DataFrame, column: str) -> go.Figure:
    """Cria gr√°fico apropriado baseado no tipo de vari√°vel."""
    var_info = analyze_variable_type(df[column])
    
    if var_info['type'] == 'quantitative':
        return create_histogram(df[column])
    elif var_info['type'] == 'categorical':
        return create_pie_chart(df[column])
```

## ü§ñ Integra√ß√£o com IA

### 1. Configura√ß√£o de Modelos

#### Classe Assistente IA
```python
class AIAssistant:
    def __init__(self):
        self.model = self._detect_available_model()
        self.context = ""
    
    def _detect_available_model(self) -> str:
        """Detecta qual modelo de IA est√° dispon√≠vel."""
        if self._ollama_available():
            return "ollama"
        elif self._gemini_available():
            return "gemini"
        else:
            return "none"
    
    def chat(self, message: str, context: str = "") -> str:
        """Envia mensagem para o assistente IA."""
        if self.model == "ollama":
            return self._ollama_chat(message, context)
        elif self.model == "gemini":
            return self._gemini_chat(message, context)
        else:
            return "IA n√£o dispon√≠vel"
```

### 2. Configura√ß√£o de APIs

#### Arquivo .env
```env
# Configura√ß√µes de IA
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=llama3.1

GEMINI_API_KEY=sua_chave_gemini
OPENAI_API_KEY=sua_chave_openai

# Configura√ß√µes da aplica√ß√£o
ENABLE_AI=true
ENABLE_EXCEL_ADVANCED=true
ENABLE_PDF=true
```

## üì§ Exporta√ß√£o e Relat√≥rios

### 1. Exporta√ß√£o Excel

#### Fun√ß√£o de Exporta√ß√£o
```python
def export_to_excel(df: pd.DataFrame, stats: Dict = None) -> bytes:
    """Exporta dados e estat√≠sticas para Excel."""
    output = io.BytesIO()
    
    with pd.ExcelWriter(output, engine='xlsxwriter') as writer:
        # Dados originais
        df.to_excel(writer, sheet_name='Dados', index=False)
        
        # Estat√≠sticas descritivas
        if stats:
            stats_df = pd.DataFrame(stats).T
            stats_df.to_excel(writer, sheet_name='Estat√≠sticas')
        
        # Formata√ß√£o
        workbook = writer.book
        format_header = workbook.add_format({'bold': True})
        
        # Aplicar formata√ß√£o
        worksheet = writer.sheets['Dados']
        for col_num, value in enumerate(df.columns.values):
            worksheet.write(0, col_num, value, format_header)
    
    return output.getvalue()
```

### 2. Relat√≥rios PDF

#### Gera√ß√£o de PDF
```python
def generate_pdf_report(df: pd.DataFrame, stats: Dict, plots: Dict) -> bytes:
    """Gera relat√≥rio PDF com an√°lises."""
    buffer = io.BytesIO()
    doc = SimpleDocTemplate(buffer, pagesize=A4)
    
    story = []
    
    # T√≠tulo
    story.append(Paragraph("Relat√≥rio de An√°lise de Dados", style='Title'))
    story.append(Spacer(1, 12))
    
    # Estat√≠sticas
    story.append(Paragraph("Estat√≠sticas Descritivas", style='Heading1'))
    for var, stat in stats.items():
        story.append(Paragraph(f"{var}: {stat}", style='Normal'))
    
    doc.build(story)
    return buffer.getvalue()
```

## üß™ Testes e Valida√ß√£o

### 1. Testes de Fun√ß√µes

#### Template de Teste
```python
import unittest
import pandas as pd
from core.stats import descriptive_stats

class TestStats(unittest.TestCase):
    def test_descriptive_stats(self):
        """Testa fun√ß√£o de estat√≠sticas descritivas."""
        data = pd.Series([1, 2, 3, 4, 5])
        result = descriptive_stats(data)
        
        self.assertEqual(result['N'], 5)
        self.assertEqual(result['M√©dia'], 3.0)
        self.assertEqual(result['M√≠nimo'], 1)
        self.assertEqual(result['M√°ximo'], 5)
    
    def test_empty_series(self):
        """Testa comportamento com s√©rie vazia."""
        data = pd.Series([])
        
        with self.assertRaises(ValueError):
            descriptive_stats(data)
```

### 2. Valida√ß√£o de Dados

#### Testes de Integra√ß√£o
```python
def test_data_pipeline():
    """Testa pipeline completo de processamento."""
    # Carregar dados de teste
    df = pd.read_csv('test_data.csv')
    
    # Validar estrutura
    assert validate_dataframe(df), "DataFrame inv√°lido"
    
    # Processar dados
    df_clean, info = clean_data(df)
    
    # Validar resultado
    assert not df_clean.empty, "Dados limpos est√£o vazios"
    assert info['success'], "Limpeza falhou"
    
    # An√°lise estat√≠stica
    stats = comprehensive_descriptive_analysis(df_clean)
    
    # Validar estat√≠sticas
    assert len(stats) > 0, "Nenhuma estat√≠stica calculada"
```

## üöÄ Deploy e Distribui√ß√£o

### 1. Arquivo requirements.txt
```
streamlit>=1.28.0
pandas>=1.5.0
numpy>=1.24.0
plotly>=5.15.0
scipy>=1.10.0
openpyxl>=3.1.0
xlsxwriter>=3.1.0
reportlab>=4.0.0
requests>=2.31.0
python-dotenv>=1.0.0
ollama>=0.1.0
google-generativeai>=0.3.0
openai>=1.0.0
```

### 2. Script de Execu√ß√£o
```bash
#!/bin/bash
# Script para executar a aplica√ß√£o

# Verificar Python
if ! command -v python &> /dev/null; then
    echo "Python n√£o encontrado. Instale Python 3.8+ primeiro."
    exit 1
fi

# Verificar depend√™ncias
if ! pip show streamlit &> /dev/null; then
    echo "Instalando depend√™ncias..."
    pip install -r requirements.txt
fi

# Executar aplica√ß√£o
echo "Iniciando aplica√ß√£o..."
streamlit run app.py
```

## üìö Documenta√ß√£o de C√≥digo

### 1. Docstrings
```python
def complex_function(param1: str, param2: int) -> Dict[str, Any]:
    """
    Fun√ß√£o complexa que faz v√°rias opera√ß√µes.
    
    Esta fun√ß√£o realiza uma an√°lise complexa dos dados fornecidos,
    aplicando m√∫ltiplas transforma√ß√µes e retornando um dicion√°rio
    com os resultados.
    
    Args:
        param1 (str): Primeiro par√¢metro - descri√ß√£o detalhada
        param2 (int): Segundo par√¢metro - deve ser positivo
    
    Returns:
        Dict[str, Any]: Dicion√°rio contendo:
            - 'result': Resultado principal da an√°lise
            - 'metadata': Informa√ß√µes adicionais sobre o processamento
            - 'errors': Lista de erros encontrados (se houver)
    
    Raises:
        ValueError: Se param2 for negativo
        TypeError: Se param1 n√£o for string
    
    Example:
        >>> result = complex_function("dados", 10)
        >>> print(result['result'])
        'An√°lise conclu√≠da'
    
    Note:
        Esta fun√ß√£o pode demorar para processar grandes volumes de dados.
        Considere usar cache para melhorar performance.
    """
    pass
```

### 2. Coment√°rios no C√≥digo
```python
# Configura√ß√£o inicial do Streamlit
st.set_page_config(
    page_title="Tio ZooEstatisco",
    page_icon="üêÇ",
    layout="wide"
)

# Verificar se dados foram carregados
if 'df_clean' not in st.session_state:
    st.warning('‚ö†Ô∏è Nenhum dado carregado. V√° para **Upload e An√°lise** primeiro.')
    st.stop()

# TODO: Implementar cache para melhorar performance
# FIXME: Corrigir bug na exporta√ß√£o Excel com caracteres especiais
# NOTE: Esta fun√ß√£o pode ser otimizada usando vectoriza√ß√£o do NumPy
```

## ‚úÖ Boas Pr√°ticas Implementadas

### 1. C√≥digo Limpo
- ‚úÖ Nomes descritivos para vari√°veis e fun√ß√µes
- ‚úÖ Fun√ß√µes pequenas e focadas
- ‚úÖ Coment√°rios explicativos
- ‚úÖ Tratamento robusto de erros

### 2. Performance
- ‚úÖ Cache do Streamlit para opera√ß√µes pesadas
- ‚úÖ Processamento em chunks para arquivos grandes
- ‚úÖ Otimiza√ß√£o de mem√≥ria com tipos apropriados
- ‚úÖ Lazy loading de componentes

### 3. Manutenibilidade
- ‚úÖ Separa√ß√£o de responsabilidades
- ‚úÖ M√≥dulos bem organizados
- ‚úÖ Configura√ß√£o externa (arquivos .env)
- ‚úÖ Logs detalhados para debugging

### 4. Usabilidade
- ‚úÖ Interface intuitiva
- ‚úÖ Mensagens de erro claras
- ‚úÖ Valida√ß√£o de entrada
- ‚úÖ Feedback visual para o usu√°rio

## üéØ Conclus√£o

Esta metodologia de programa√ß√£o garante que o c√≥digo seja:
- **Leg√≠vel**: F√°cil de entender e manter
- **Robusto**: Tratamento adequado de erros
- **Perform√°tico**: Otimizado para grandes volumes de dados
- **Extens√≠vel**: F√°cil de adicionar novas funcionalidades
- **Test√°vel**: Estrutura que facilita testes automatizados

O projeto segue as melhores pr√°ticas da comunidade Python e est√° preparado para crescimento e manuten√ß√£o a longo prazo.
